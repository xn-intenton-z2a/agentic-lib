sandbox/features/archived/TestFeature2.md
# sandbox/features/archived/TestFeature2.md
Second feature summary goes here.sandbox/features/archived/TestFeature1.md
# sandbox/features/archived/TestFeature1.md
This is the first test feature summary.sandbox/features/WORKFLOW_DIAGRAM.md
# sandbox/features/WORKFLOW_DIAGRAM.md
# Objective & Scope

Expand the CLI toolkit feature to unify workflow visualization, advanced cost modeling with threshold alerts, archived features overview, SQS event simulation, version metadata reporting, and interactive help instructions in a single, cohesive interface.

# Value Proposition

Provide developers and DevOps engineers with a consolidated CLI tool that:

- Visualizes pipeline and Lambda interactions using mermaid diagrams.
- Models CPU, memory, and monetary cost per workflow step and automatically flags steps exceeding a user-defined USD threshold.
- Lists archived feature documentation summaries in both human-readable and machine-readable formats.
- Simulates SQS digest events to facilitate end-to-end testing of Lambda handlers.
- Reports the library version and current timestamp for reproducible builds.
- Displays comprehensive usage guidance on demand.

This unified approach reduces context switching, accelerates debugging and cost optimization, and supports sandbox testing workflows out of the box.

# Success Criteria & Requirements

- **processDiagram** enhancements:
  - Accept flags: --diagram, --cost-model, --cost-threshold=<USD>, --format=json or --format=markdown (default).
  - Use existing generateDiagram and generateCostModel to assemble:
    - Mermaid flowchart.
    - Cost table of {step, cpuMs, memoryMb, costUsd}.
    - Alerts section in markdown or `alerts` field in JSON for steps where costUsd > threshold.

- **processFeaturesOverview**:
  - Accept --features-overview and --format=json|markdown.
  - Read archived markdown files and output summaries as headings or JSON array of {name,summary}.

- **processDigest**:
  - Introduce --digest flag.
  - Generate an SQS event via createSQSEventFromDigest(exampleDigest) and invoke digestLambdaHandler.
  - Log all info and errors as JSON entries through logInfo/logError.

- **processVersion**:
  - Introduce --version flag.
  - Read package.json version field and output JSON {version, timestamp}.
  - On failure, emit structured error via logError.

- **processHelp**:
  - Introduce --help flag.
  - Display usage instructions generated by generateUsage() in plain text.

- **main** entrypoint:
  - Orchestrate flag combinations:
    - When both --diagram and --features-overview with --format=json, combine diagram JSON and featuresOverview array.
    - Respect ordering and ensure a single consolidated JSON or markdown output.
  - Fallback to help output when no recognized flag is provided.

- **Testing**:
  - Add or update unit tests in sandbox/tests/cli.test.js to verify:
    - processDigest logs at least one info entry and returns true.
    - processVersion logs valid JSON with version and timestamp.
    - processHelp returns true and logs usage instructions.
    - main handles each flag independently and in combination, with and without --format=json.
  - Maintain existing diagram and overview tests and integrate new flag tests.

- **Documentation**:
  - Update sandbox/docs/CLI_TOOLKIT.md and sandbox/README.md to include usage examples for --digest, --version, and --help alongside existing flags.
  - Provide example outputs for both markdown and JSON modes where applicable.

# User Scenarios & Examples

Scenario: A user seeks guidance on available CLI commands:

    node sandbox/source/main.js --help

They see usage instructions listing --diagram, --features-overview, --digest, --version, and --help.

Scenario: A continuous integration pipeline reports the current library version:

    node sandbox/source/main.js --version

Outputs:

    {"version":"6.4.2-0","timestamp":"2024-07-18T12:34:56.789Z"}

Scenario: A QA engineer tests the digest handler:

    node sandbox/source/main.js --digest

They observe structured logs for the simulated SQS event and any error boundaries.

Scenario: A DevOps engineer optimizes pipeline cost, flagging steps over 0.75 USD:

    node sandbox/source/main.js --diagram --cost-model --cost-threshold=0.75

They receive a mermaid flowchart, cost table, and an Alerts section highlighting expensive steps.

Scenario: A documentation bot aggregates archived features as JSON for publishing:

    node sandbox/source/main.js --features-overview --format=json

They receive an array of {name,summary} entries for each archived feature.

# Verification & Acceptance

- All new and existing CLI behaviors covered by unit and integration tests, with mocks for console and file I/O.
- Documentation examples render correctly in markdown and JSON in both CLI_TOOLKIT.md and sandbox/README.md.
- No loss of existing functionality; all previous diagram and overview tests continue to pass.