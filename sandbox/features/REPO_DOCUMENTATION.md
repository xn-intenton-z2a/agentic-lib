# Objective and Scope
Extend the automated repository documentation feature to include token usage and runtime cost reporting in discussion summaries generated by the CLI.

# Value Proposition
Provide clear, per‚Äêdiscussion visibility into AI usage by reporting total tokens consumed and estimated runtime cost alongside engagement metrics. This empowers maintainers to monitor spending at the point of discussion and optimize AI usage for cost efficiency.

# Requirements

## Source Updates in src/lib/main.js

- fetchChatGptUsageMetrics
  - Extend the existing function to accept a discussion identifier or context parameter.
  - Return an object with totalTokens, totalCost, currency, and optional breakdown by message type (prompt vs completion).

- generateDiscussionSummaryMarkdown
  - Add a costMetrics parameter when includeCosts flag is true.
  - After the visual metrics chart, insert a Cost Metrics section:
    - Display total tokens used and total cost in currency.
    - Include a table listing breakdown by message type.

- CLI integration
  - Introduce a new flag --include-costs (alias --ic) for the --summarize-discussion command.
  - When includeCosts is true, call fetchChatGptUsageMetrics before summary generation and pass the result to generateDiscussionSummaryMarkdown.

## Documentation Updates

- sandbox/README.md
  - Document the --include-costs flag alongside existing flags:
    node src/lib/main.js --summarize-discussion 42 --include-visual-metrics --include-costs

- docs/USAGE.md
  - Add a section explaining the new --include-costs flag and include usage examples.

## Tests in tests/unit/main.test.js

- Mock fetchChatGptUsageMetrics to return sample token and cost data.
  - Verify that generateDiscussionSummaryMarkdown outputs a Cost Metrics heading, total tokens, cost, and breakdown table when includeCosts is true.

- Test CLI invocation:
  - Ensure running node src/lib/main.js --summarize-discussion 42 --include-visual-metrics --include-costs triggers both generateDiscussionSummaryMarkdown and fetchChatGptUsageMetrics, and posts the comment with cost details.

# Verification and Acceptance

- All unit tests pass under npm test.
- Manual test: Run node src/lib/main.js --summarize-discussion 42 --include-visual-metrics --include-costs
  - Confirm the posted discussion summary contains a Cost Metrics subsection with token usage and cost estimates.
- Confirm that summaries generated without --include-costs remain unchanged.