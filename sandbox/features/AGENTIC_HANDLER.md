# Agentic Handler

This feature adds a new function agenticHandler to process GitHub events, orchestrate agentic workflows via OpenAI chat completions, and forward enriched digests through the existing pipeline.

# Value Proposition

- Provides a streamlined integration point for AI-driven automation by invoking AI reasoning during event processing.
- Enhances the digest pipeline with context-aware suggestions and action plans generated by OpenAI, reducing manual intervention.
- Leverages existing createSQSEventFromDigest and digestLambdaHandler for downstream processing and consistency.

# Success Criteria & Requirements

- Expose an async function agenticHandler that accepts an object with headers and JSON body.
- Detect event type by inspecting X-Github-Event header and body.event for workflow_call events.
- For workflow_call events, extract workflow name, action, inputs, and repository context.
- Build a chat prompt combining event metadata and inputs.
- Use OpenAI createChatCompletion with system and user messages to generate a structured JSON plan.
- Parse the AI response into an aiPlan object and attach it to the digest payload.
- Create an SQS event via createSQSEventFromDigest and invoke digestLambdaHandler with the enriched digest.
- Emit structured logs for the request, AI invocation, AI response, and final dispatch.
- Return an HTTP response object with statusCode 200 and a body containing the aiPlan and dispatch confirmation, or an error statusCode and detailed error body on failure.

# Usage Example

Import and use within an HTTP framework or serverless function:

const { agenticHandler } = require('@xn-intenton-z2a/agentic-lib');

async function handler(req, res) {
  const result = await agenticHandler({ headers: req.headers, body: req.body });
  res.status(result.statusCode).send(result.body);
}

# Verification & Acceptance

- Unit tests cover valid event conversions, AI invocation with mocked OpenAI, and correct HTTP response formatting.
- Simulate missing OpenAI API key, invalid chat response format, and malformed events to assert appropriate error codes and logs.
- Tests verify that aiPlan is included in the digest for workflow_call events and dispatched properly.
- Code adheres to ESM standards, runs on Node 20+, and passes lint and formatting rules.